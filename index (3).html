<div id="lu120-wrap" style="background:#f8fafc;border:1.5px solid #e2e8f0;border-radius:12px;padding:18px 20px;margin:8px 0;font-family:Arial,sans-serif;">
  <div style="font-size:15px;font-weight:700;color:#1e293b;margin-bottom:4px;">Step 1 â€” Check Your Address</div>
  <div style="font-size:12px;color:#64748b;margin-bottom:12px;">You must live within the L.U. 120 service area at the time of application to be eligible.</div>
  <div style="display:flex;gap:8px;">
    <input type="text" id="lu120-input" placeholder="e.g. 123 Main St, London, ON" autocomplete="off"
      style="flex:1;padding:10px 13px;border:1.5px solid #cbd5e1;border-radius:8px;font-size:14px;color:#0f172a;outline:none;background:#fff;"/>
    <button type="button" id="lu120-btn" onclick="lu120Check()"
      style="background:#1a3a5c;color:#fff;border:none;border-radius:8px;padding:10px 18px;font-size:14px;font-weight:600;cursor:pointer;white-space:nowrap;">
      <span id="lu120-btn-text">Check</span>
    </button>
  </div>
  <div style="font-size:11px;color:#94a3b8;margin-top:5px;">Include city name â€” e.g. "London, ON" or "Woodstock, ON"</div>
  <div id="lu120-result" style="display:none;margin-top:12px;border-radius:8px;padding:12px 14px;font-size:13px;line-height:1.5;"></div>
  <div id="lu120-block" style="display:none;margin-top:10px;background:#fef2f2;border:1.5px solid #fca5a5;border-radius:8px;padding:10px 14px;font-size:12px;color:#991b1b;text-align:center;">
    â›” You must confirm your address is within our coverage area to proceed.
  </div>
</div>

<script>
(function(){

  // â”€â”€ Hard exclusion list â€” blocked regardless of polygon result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  var EXCL = [
    // Chatham-Kent
    'chatham','chatham-kent','wallaceburg','ridgetown','palmyra','blenheim',
    'wheatley','leamington','kingsville','tilbury','merlin','bothwell',
    // Windsor-Essex
    'essex','windsor','lasalle','tecumseh','lakeshore','amherstburg',
    'harrow','belle river','comber','cottam',
    // Lambton County â€” L.U. 530 Sarnia territory
    'sarnia','point edward','corunna','mooretown','petrolia',
    'forest','watford','thedford','arkona','kettle point','aazhoodena',
    'grand bend','alvinston','brooke','brooke-alvinston','lambton',
    'oil springs','oil city','florence','inwood','sombra','port lambton',
    'courtright','wilkesport','dawn-euphemia',
    // East / northeast out-of-zone
    'hamilton','burlington','oakville','mississauga','toronto','brampton',
    'kitchener','waterloo','cambridge','guelph',
    'brantford','paris','brant county','county of brant'
  ];

  // â”€â”€ Boundary polygon [lng, lat] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Key coordinates verified:
  //   Chatham:    [-82.19, 42.40] EXCLUDED (keyword + outside polygon)
  //   Grand Bend: [-81.76, 43.31] EXCLUDED (keyword)
  //   Alvinston:  [-81.86, 42.82] EXCLUDED (keyword)
  //   Strathroy:  [-81.97, 42.96] INCLUDED (inside polygon, not in exclusion list)
  //   Bayfield:   [-81.70, 43.56] INCLUDED
  //   Goderich:   [-81.71, 43.74] INCLUDED
  //   London:     [-81.25, 42.98] INCLUDED
  //   Woodstock:  [-80.75, 43.13] INCLUDED
  //   St Thomas:  [-81.20, 42.78] INCLUDED
  var POLY=[
    // South â€” Lake Erie shoreline, east to west
    [-80.95, 42.48],
    [-81.02, 42.45],
    [-81.08, 42.43],
    [-81.15, 42.40],
    [-81.22, 42.38],
    [-81.30, 42.36],
    [-81.38, 42.32],  // Aylmer
    [-81.45, 42.30],
    [-81.52, 42.28],  // Central Elgin
    [-81.60, 42.27],  // Port Stanley
    [-81.65, 42.25],  // Sparta
    [-81.72, 42.22],  // Shedden
    [-81.78, 42.20],  // Fingal
    [-81.85, 42.22],  // Iona Station
    [-81.95, 42.20],  // Dutton/Dunwich
    [-82.02, 42.22],  // West of Dutton
    [-82.08, 42.25],  // West Lorne
    [-82.12, 42.28],  // Rodney
    [-82.15, 42.32],  // West Elgin SW corner

    // West boundary â€” follows Middlesex County line northward
    // Chatham is at -82.19 lng â€” boundary stays well east at -82.10 to -82.15
    [-82.10, 42.40],  // Glencoe area (Glencoe itself at -81.72, safely inside)
    [-82.08, 42.52],  // Middlesex west
    [-82.08, 42.65],  // Middlesex/Lambton border area
    [-82.10, 42.78],  // North of Glencoe
    [-82.05, 42.90],  // Middlesex northwest
    [-82.00, 43.00],  // Bosanquet / Huron boundary
    [-81.92, 43.12],  // Huron County south
    [-81.82, 43.22],  // South Huron west
    [-81.78, 43.32],  // Huron Park area
    [-81.72, 43.42],  // Exeter area west
    [-81.72, 43.52],  // South Huron
    [-81.75, 43.58],  // Bayfield area (Bayfield at -81.70, inside)
    [-81.78, 43.65],  // Huron west coast
    [-81.85, 43.72],  // Kingsbridge / Dungannon
    [-81.95, 43.80],  // Auburn / Saltford
    [-82.00, 43.88],  // Goderich area (Goderich at -81.71, well inside)
    [-81.95, 43.95],
    [-81.88, 44.00],
    [-81.78, 44.02],  // Clinton
    [-81.70, 44.05],
    [-81.62, 44.10],  // Hensall / Egmondville
    [-81.55, 44.12],  // Seaforth
    [-81.45, 44.15],  // Kippen
    [-81.35, 44.18],  // Londesborough
    [-81.28, 44.22],  // Brussels
    [-81.20, 44.25],  // Blyth
    [-81.10, 44.28],
    [-81.00, 44.30],  // North boundary

    // Northeast â€” turn back south
    [-80.58, 44.22],
    [-80.62, 44.18],
    [-80.68, 44.15],
    [-80.72, 44.12],
    [-80.78, 44.10],  // Wroxeter
    [-80.80, 44.05],
    [-80.85, 44.00],
    [-80.88, 43.95],
    [-80.90, 43.90],
    [-80.88, 43.85],
    [-80.85, 43.78],
    [-80.82, 43.72],
    [-80.80, 43.65],
    [-80.75, 43.58],
    [-80.72, 43.52],
    [-80.68, 43.48],
    [-80.65, 43.42],  // East boundary â€” Waterloo/KW excluded by keyword
    [-80.65, 43.38],
    [-80.62, 43.32],
    [-80.60, 43.25],
    [-80.58, 43.18],
    [-80.60, 43.12],
    [-80.62, 43.08],
    [-80.68, 43.05],  // Woodstock east
    [-80.72, 43.02],
    [-80.78, 43.00],
    [-80.82, 42.95],
    [-80.85, 42.90],  // Brant County line â€” Brantford excluded by keyword
    [-80.85, 42.80],
    [-80.85, 42.70],
    [-80.88, 42.65],
    [-80.95, 42.58],
    [-80.95, 42.48],  // back to start
  ];

  function pip(pt,poly){
    var x=pt[0],y=pt[1],inside=false;
    for(var i=0,j=poly.length-1;i<poly.length;j=i++){
      var xi=poly[i][0],yi=poly[i][1],xj=poly[j][0],yj=poly[j][1];
      if((yi>y)!==(yj>y)&&x<(xj-xi)*(y-yi)/(yj-yi)+xi)inside=!inside;
    }
    return inside;
  }

  function isExcluded(name){
    var low=name.toLowerCase();
    for(var i=0;i<EXCL.length;i++) if(low.indexOf(EXCL[i])!==-1) return true;
    return false;
  }

  function setSubmit(show){
    // Cast a very wide net to catch JotForm's submit button in any theme/configuration
    var sel=[
      '.form-submit-button',
      'button[type="submit"]',
      'input[type="submit"]',
      '[class*="submit"]',
      '[class*="Submit"]',
      '.jf-form-buttons button',
      '.form-button-wrapper button',
      '.form-pagebreak-next',
      'button[data-component="button"]',
      '[id*="submit"]',
      '[id*="Submit"]'
    ];
    
    var found = false;
    sel.forEach(function(s){
      try{
        document.querySelectorAll(s).forEach(function(el){
          // Don't hide our own coverage check button
          if(el.id==='lu120-btn') return;
          
          // Check if this looks like a submit button by checking text content
          var text = (el.innerText || el.value || '').toLowerCase();
          if(text.indexOf('submit')!==-1 || text.indexOf('send')!==-1 || text.indexOf('apply')!==-1 || el.type==='submit'){
            el.style.display=show?'':'none';
            el.style.pointerEvents=show?'':'none';
            el.style.visibility=show?'':'hidden';
            el.disabled=!show;
            found = true;
          }
        });
      }catch(e){}
    });
    
    // Nuclear option: if we still haven't found it, hide ALL buttons except our checker button
    if(!found && !show){
      try{
        document.querySelectorAll('button, input[type="button"], input[type="submit"]').forEach(function(el){
          if(el.id==='lu120-btn') return;
          var isOurWidget = el.closest('#lu120-wrap');
          if(!isOurWidget){
            el.style.display='none';
            el.style.pointerEvents='none';
            el.disabled=true;
          }
        });
      }catch(e){}
    }
    
    document.getElementById('lu120-block').style.display=show?'none':'block';
  }

  function showResult(type,icon,title,msg,addr){
    var el=document.getElementById('lu120-result');
    var bg=type==='yes'?'#f0fdf4':type==='no'?'#fef2f2':'#fef9ec';
    var bdr=type==='yes'?'#86efac':type==='no'?'#fca5a5':'#fcd34d';
    var tc=type==='yes'?'#15803d':type==='no'?'#991b1b':'#92400e';
    el.style.cssText='display:block;margin-top:12px;border-radius:8px;padding:12px 14px;font-size:13px;line-height:1.5;background:'+bg+';border:1.5px solid '+bdr+';';
    el.innerHTML='<span style="font-size:20px;vertical-align:middle;margin-right:8px;">'+icon+'</span>'
      +'<span style="font-weight:700;color:'+tc+';">'+title+'</span><br>'
      +'<span style="color:#374151;">'+msg+'</span>'
      +(addr?'<br><span style="font-size:11px;color:#94a3b8;font-style:italic;">Matched: '+addr+'</span>':'');
  }

  function setLoading(on){
    document.getElementById('lu120-btn').disabled=on;
    document.getElementById('lu120-btn-text').textContent=on?'Checkingâ€¦':'Check';
    document.getElementById('lu120-btn').style.background=on?'#94a3b8':'#1a3a5c';
  }

  window.lu120Check=function(){
    var raw=document.getElementById('lu120-input').value.trim();
    if(!raw){showResult('warn','âš ï¸','Please enter an address','Type your service address above.','');setSubmit(false);return;}
    var q=raw;
    if(!/ontario|,\s*on\b|canada/i.test(q)) q+=', Ontario, Canada';
    setLoading(true);setSubmit(false);

    fetch('https://nominatim.openstreetmap.org/search?format=json&limit=1&q='+encodeURIComponent(q)+'&countrycodes=ca',
      {headers:{'Accept-Language':'en','User-Agent':'LU120/1.0'}})
    .then(function(r){return r.json();})
    .then(function(data){
      if(!data||!data.length){
        showResult('warn','â“','Address not found',"Couldn't find that address. Try adding your city name or postal code.",'');
        setSubmit(false);return;
      }
      var lat=parseFloat(data[0].lat),lng=parseFloat(data[0].lon),name=data[0].display_name;
      var eligible=pip([lng,lat],POLY) && !isExcluded(name);
      if(eligible){
        showResult('yes','âœ…',"You're in our coverage area!",'Your address is within the L.U. 120 London service area. You may proceed with the application.',name);
        setSubmit(true);
      } else {
        showResult('no','ğŸš«','Not eligible â€” outside our jurisdiction','Your address is not within the L.U. 120 London service area. You must reside within our jurisdiction at the time of application to be eligible. This application cannot be submitted.',name);
        setSubmit(false);
      }
    })
    .catch(function(){
      showResult('warn','ğŸ”Œ','Connection error','Address lookup failed. Check your internet connection and try again.','');
      setSubmit(false);
    })
    .finally(function(){setLoading(false);});
  };

  document.getElementById('lu120-input').addEventListener('keydown',function(e){
    if(e.key==='Enter'){e.preventDefault();lu120Check();}
  });

  setTimeout(function(){setSubmit(false);},800);
})();
</script>
